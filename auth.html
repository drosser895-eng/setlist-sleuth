<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Authenticating with Spotify...</title>
    <script>
        (function() {
            console.log('auth.html loaded.');
            const hash = window.location.hash;
            console.log('auth.html hash:', hash);

            if (hash) {
                const match = hash.match(/access_token=([^&]*)/);
                if (match) {
                    const token = match[1];
                    console.log('auth.html parsed token:', token);
                    window.localStorage.setItem("token", token);
                    console.log('auth.html token stored in localStorage.');
                } else {
                    console.log('auth.html hash found, but no access_token. Checking for error...');
                    const errorMatch = hash.match(/error=([^&]*)/);
                    if (errorMatch) {
                        console.error('auth.html received error from Spotify:', errorMatch[1]);
                        // Optionally, store error in localStorage or pass it via query param
                    }
                }
            } else {
                console.log('auth.html loaded without a hash.');
            }
            // Redirect back to the main app page
            // The gh-pages subdirectory is /setlist-sleuth/
            const redirectTarget = '/setlist-sleuth/';
            console.log('auth.html redirecting to:', redirectTarget);
            window.location.replace(redirectTarget);
        })();
    </script>
</head>
<body>
    <p>Authenticating... Please wait.</p>
    <div id="debug-info"></div>
    <script>
        (function() {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML += '<p>auth.html loaded.</p>';
            
            const hash = window.location.hash;
            debugDiv.innerHTML += `<p>auth.html hash: <code>${hash}</code></p>`;

            if (hash) {
                const match = hash.match(/access_token=([^&]*)/);
                if (match) {
                    const token = match[1];
                    debugDiv.innerHTML += `<p>auth.html parsed token: <code>${token.substring(0, 10)}...</code></p>`;
                    window.localStorage.setItem("token", token);
                    debugDiv.innerHTML += '<p>auth.html token stored in localStorage.</p>';
                } else {
                    debugDiv.innerHTML += '<p>auth.html hash found, but no access_token. Checking for error...</p>';
                    const errorMatch = hash.match(/error=([^&]*)/);
                    if (errorMatch) {
                        debugDiv.innerHTML += `<p style="color: red;">auth.html received error from Spotify: ${errorMatch[1]}</p>`;
                    }
                }
            } else {
                debugDiv.innerHTML += '<p>auth.html loaded without a hash.</p>';
            }
            const redirectTarget = '/setlist-sleuth/';
            debugDiv.innerHTML += `<p>auth.html redirecting to: ${redirectTarget}</p>`;
            window.location.replace(redirectTarget);
        })();
    </script>
</body>
</html>
